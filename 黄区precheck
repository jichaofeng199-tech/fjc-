    Product name产品名称	Confidentiality level密级
Charlotte	机密
Product version产品版本	Total 21 pages 共21页
V100R001C10	

AF precheck文档



Prepared by
拟制	李婷 l00483316	Date
日期	
Reviewed by
审核人		Date
日期	
Reviewed by
审核人		Date
日期	
Approved by
批准		Date
日期	





Huawei Technologies Co., Ltd.
华为技术有限公司
All rights reserved
版权所有 侵权必究


(HDP02T03 V3.1S01/IPD-HCMM/for internal use only)
(HDP02T03 V3.1S01/IPD-HCMM/仅供内部使用)




修订记录
时间	版本	更新内容	
2022.09.26	第一版	初版AF precheck文档	李婷
2024.04.11	第二版	更新马达稳定性和磁滞	秦亚文


目  录



















AF Precheck文档
1信息收集
在项目开始前，需收集一些信息，方便更好的了解项目信息评估风险，如下：
1.各个模组器件规格和匿名化表格， 
2.Sensor、马达、lens互配表
3.景深表
4.马达稳定时间
5.激光信息（激光厂商、测距能力、激光camera间距等）
1.1模组规格和匿名化互配表
以TWE-D项目项目为例，查询到如下信息
了解模组的组成配置（sensor型号、马达、焦距、pixel、lens、光圈、模组对焦类型等），了解哪些器件变更，哪些器件继承。


1.2景深表
以BLK后主为例，找lens同事提供景深表数据

了解焦距、pixel、coc对应距离的前后景深的大小

1.3马达稳定时间
请马达同事提供马达稳定时间表格，可参考如下表格格式

1.4激光器件信息
找激光同事确认激光厂商、激光测距能力等信息，在项目前期收集激光和camera排列信息，激光的位置和camera的摆放会影响到激光的对焦准确性。如下为BA项目激光信息，

		x	y
A	main	16.71	5.55
	wide	3.52	13.98
	tele	16.71	33.9
A+	main	16.71	5.55
	wide	3.52	13.98
	tele	16.71	33.9

2AF整机 precheck
2.1AF 马达check
2.1.1马达磁滞
该项测试主要用于检查镜头迟滞问题。会从远端位置向近端位置扫描镜头，之后会以相反方向再次扫描镜头。这两个方向的对焦峰值应近乎相同。如果在两个相反方向上的对焦峰值不同，则表示镜头模块存在严重迟滞。
测试方法：
1.在 500 lux 以上的照明条件下，将 MTF图卡放置在距离三脚架上的设备100cm远的地方。
2.手机放置在三角架上，连接手机。执行脚本开启pdtest测试，执行pdtest双向测试命令（模式设置为2），打开camera切到对应camera并开始测试
adb shell setprop vendor.camera.firmware.debug AF_RPOPERTY_TEST#TEST_PD_ACCURACY_FLAG#2,0,0,10,3
// 模式，起点，终点，步长，频率
3.可以看到画面从模糊->清晰->模糊，随后模糊->清晰->模糊。
4.测试完成后，将isp log导出。使用工具，注意勾选上马达双向，画出pdtest结果图
	
步骤一	步骤二

5.测试结果生成在isp log路径里，如下为hisi平台测试结果
hisi磁滞测试结果

测试标准：如果两个方向的峰值位置相同，如图 A 所示，则表示镜头模块正常。如果两个方向的峰值位置相差超过 10%，如图 B 所示，则表明该模块存在较大迟滞。执行此测试两次以上，确认是否存在差异

2.1.2马达稳定性测试

该项测试主要目的是检查同一镜头位置下多帧对焦值的一致性，从而检查发出镜头移动命令后，镜头是否稳定
测试方法：
1.在 500 lux 以上的照明条件下，在MTF测试卡放置在距离三脚架上的设备 100 cm远的地方。
2.设置fullsweep不同步长（20、50、100） 每帧等待10帧，开始fullsweep
adb shell setprop vendor.camera.firmware.debug AF_RPOPERTY_TEST#TEST_PD_ACCURACY_FLAG#1,0,0,20,10
// 模式，起点，终点，步长，频率
3.测试后将isp log导出，使用工具autosystem 工具画面马达稳定时间曲线，工具操作界面如下：
	

步骤一	步骤二
4.测试结果在isplog 同级路径文件夹下，工具测试结果如下：
步长20

步长50

步长100

测试标准：如果绘制的关系图与图 A 相似，则表示马达设置已正确配置。如果绘制的关系图与图 B相似，等帧过程中FV有跳变，则表示马达稳定时间可能存在问题。重复测试两次以上来确定问题是否真正存在。若确认问题存在，则反馈马达同事

2.1.3马达范围测试
该测试将检查微距和无穷远时的边界范围。测试会检查镜头是否有足够的移动范围，可对焦微距/无穷远处的物体。
测试方法：
1.在 500 lux 以上的光照条件下，将MTF图卡放置在距离三脚架上的设备最近对焦距离处，进行微距测试。在 500 cm 的位置重复执行测试，从而执行无限远测试
2.如果马达为开环马达，则还需测试该设备在以下位置的对焦情况：
	            ■将设备镜头朝下安装在三脚架上（即朝下位置）
                ■ 将设备镜头朝上安装在三脚架上（即朝上位置）
3.执行pdtest命令，做全量程搜索遍历
4.将log导出，使用autosystem画出cdaf曲线图
测试标准：如果绘制的关系图与微距和无限远（通过）图相似，则表明马达设置和 OTP 数据均正确。如果绘制的关系图与微距和无限远（未通过）图相似，则表明马达设置和 OTP 数据有误。重复测试两次以上来确定问题是否真正存在。也可以调试外扩参数，确认能否改善


实际预测一下各个温度范围
2.1.4Contrast对比度曲线确认
该测试通过检测对焦值图的反差（FV 最大值/FV 最小值）来检查其质量。比值越大，自动对焦算法的反差越好。
测试方法：
1.在 500 lux 以上的照明条件下，将 ISO 12233 分辨率测试卡放置在距离三脚架上的设备 30 cm远的地方。
2.开始fullsweep，导出isp log，画出FV曲线
测试标准：如果图看起来与图 A 相似，则 CAF滤波器配置正确。如果图看起来与图 B 或图 C相似，则CAF 滤波器设置不合适或者有问题。重复测试两次以上来确定问题是否真正存在。

2.1.5姿势差check
需要注意马达是开环还是闭环马达，推荐使用闭环actuator，因为它受重力和滞后的影响较小。但是闭环actuator成本高，有些也使用开环的VCMactuator。如果使用了开环的VCMactuator，应该开启姿势差补偿功能，请模组厂提供向下、向上、水平的DAC值，实测看下这个值和模组厂烧录值是否一致 
2.1.6温漂测试
Camera整体功耗较大，长时间拍照或者录像，马达的温度增长迅速，由于温度升温光学元件折射率变化，VCM热胀冷缩导致准焦code和标定有偏差，因此会产生：
1)AF对焦不准确
2）温度差异出现对物距判断失误，镜头切换不准
3）产线AFC由于温度升高，误测率高
不同sensor，温度变化，准焦code变化也不同，因此必须增加温度补偿。实际测量发现，也温度和code是类似一个线性关系。因此采用从低温箱中拿出手机持续拍照升温，从照片中获得该温度下的对焦code，拟合得到code-温度关系，具体测试方法如下：
1.降低手机温度：待测模组组装于整机中，置于温箱温度处于0度保持20 min；
2.测试环境搭建：
a)整机固定于三脚架上，jpg输出，通过倍率切换选择待测量模组；
b)chart图选择纹理细节多，易对焦的图形，chart图覆盖视场1/9区域
c)测试距离L。main和sub测试时，L<2m；tele测试时，L<5m。但不宜过于远，确保chart满足覆盖FOV
3.测试实验。点击中心对焦，10~15s拍摄一张图，测试持续25-30 min保证camera温度可上升至最高工作温度。或使用脚本可自动拍照，使得camera温度连续上升


4.数据分析
a)通过图片解析工具Exif提取温度和code信息，拟合code与温度关系，确定测试模组的温漂系数。
b)画出code和温度变化曲线，拟合一次函数，得到温飘系数K

图3 温度和code变化曲线


2.1.7马达ActuatorConfig.xml配置precheck
配置路径（以BLK为例）vendor/huawei/prebuilt/odm/hisi/burbank/BLK/camera/etc/af/c876ouo/ActuatorConfig.xml


ActuatorName：配置上面截图的actuator Type的枚举（器件表有ActuatorName）
Lenstype：配置上面截图的lens type的枚举（器件表有lens type）
actuatorType type：开闭环马达，1:close loop;0:open （问器件）
temperatureCompensateRatio：温补系数（温漂测试的曲线系数）

对应的30um和80um对应的马达稳定时间（单位ms），稳定时间问模组厂或马达厂要小批量数据（30um和80um对应的时间），挑出稳定时间较长的数据填入配置。
2.2AFC Check
1、Hisi平台不像Qcom一样，不会把OTP数据单独的dump到一个文件当中，目前确认OTP信息是否正确，只能通过log来确认。
搜索关键字：TransVcmOtpData

从上图看出otp[dis,code]:[5000,293][150,328][90,344][20,511]代表的就是广角距离和对应距离的code，因为拍广角会走双流，会显示主摄的AFC的OTP数据，从log看出有两组不同的四焦段数据。
2.2.1AFC姿势差确认测试流程 

1、首先了解该模组是否是开闭环马达，闭环马达是不需要补偿的，直接把gesture_code_offset这个参数写成0即可（参数截图红框所示），闭环马达就用H_3a.bat脚本把相关的AFlog开关和其他相关的log开关打开、3a信息打开。
2、Fulsweep命令：adb shell setprop vendor.camera.firmware.debug AF_RPOPERTY_TEST#TEST_PD_ACCURACY_FLAG#1,100,900,3,5（单程1来回2（AIAF是100），start(0表示使用默认)，end(0表示使用默认)，步长，频率(即为推马达跳帧数)；），执行该命令，就能正常的小步长手动对焦了。
3、在同等距离分别测向上、水平、向下的fullsweep的最终code，记录下来，尽量多次几次。向下、向上减去水平算出姿势差，把姿势差补到参数配置文件中（得用16进制的计数方式去补偿），如下图所示（calib_info_c854irc_af.h广角配置文件）

4、extend_code_inf和extend_code_macro,也是跑远近距Fullsweep能否找到peak点，不能找到peak点适当补偿即可，近距对焦清晰补偿extend_code_macro，远距对焦不清晰补偿extend_code_inf，补偿没用可能不是外扩的问题，另外分析其原因。

2.3PDAF Check 
PDAF check主要check 如下信息：
1、各个模式下的pd是否配置并且正常工作
2、pdaf烧录数据烧录段数是否正确，烧录距离/光圈是否正确
3、PDAF DCC烧录段数是否正确，烧录数据是否准确
4、PDAF offset是否烧录，模组厂/产线烧录数据确认，使用哪一个pd offset
5、
DCC、spc、pdoffset数据查看，需要下面路径打印数据log（包括是否使用该数据都有相关配置开关enable）
代码路径（以blk项目后置主摄为例）e/wcqin/work_code/vendor/hisi/ap/hardware/camera_product/hw_platform/sensor/burbank/blk/c876ouo

1）各个模式pd配置check：
i.	驱动路径：/srv/workspace/wcqin/work_code/vendor/hisi/histar_isp/hispv210/custom/sensor/BLK/c876ouo/cis_c876ouo_cfgs.h
通常需要检查各模式下的pd是否enable，常用的模式有拍照预览，视频预览，60fps，sHDR，2x remosaic， 4k video， 4kvideo 60fps，高帧率120fps/240fps，三方序列。填写如下表格，确认各个序列pd情况



2）在各个模式下fullsweep确认pd功能是否正常：需要注意的是，项目初期一些sHDR，高帧率等序列还未适配，可以先关注拍照和视频预览，及时与底软对齐开发计划，避免出现漏合
2.3.1驱动侧适配
2.3.1.1.2.3.1 驱动侧适配
	驱动侧修改主要针对pd的参数配置，包括pd能力、配窗能力、pd通道等
	仓：hisi/histar_isp/hispv210/custom （不同平台不一样）
	代码路径：sensor/BLK/c876ouo  （以BLK后主为例）
a）2.3.1.1 cis_c876ouo_cfgs.h
1、寄存器参数修改
	这个文件前边的参数都是一些底层具体寄存器参数的配置，其中涉及到pd通路开关等，调试过程中碰到其他pd参数都配置好了，导致isp侧收不到ppraw图，最终发现时寄存器参数配置有问题，所以需要提前和驱动确认好，是否配置ok；
2、cis_info_t c876ouo_info
	这部分就是具体的pd参数配置了，根据不同的场景、模式，可能会有多组不同的pd参数，我们只需要配置pdaf部分，type2和type3配置是不一样的，以下代码行是type2的配置
1..pdaf = {  
2.    .enable = 1,  
3.    .vc = MIPI_VIRTUAL_CHANNEL_1, \  
4.    .dt = MIPI_DATA_TYPE_RAW_10, \  
5.    .w = 4160, \  
6.    .h = 780, \  
7.    .type = PDAF_TYPE2, \  
8.    .pd_check_enable = 1,  
9.    .active_area = {  
10.        .x = 0,  
11.        .y = 0,  
12.        .width = 4160,  
13.        .height = 3120,  
14.        .x_offset = 0,  
15.        .y_offset = 0,  
16.    },  
17.    .pd_area = {  
18.        .x = 0,  
19.        .y = 0,  
20.        .width = 4160,  
21.        .height = 3120,  
22.        .x_offset = 0,  
23.        .y_offset = 0,  
24.    },  
25.    .pp_raw = {  
26.        .spc_enable = 0,  
27.        .width = 4160,  
28.        .height = 780,  
29.        .mirror = 0,  
30.    },  
31.    .pdaf_intensity = PD_CONVERGENCE_STRONGER,  
32.},  
.enable 当前这组是否支持pd
.vc
.dt 这两个参数很关键，用于配置ppraw的数据通道，isp侧需要根据这个区获取ppraw数据，需要和驱动确认好
.w
.h 这两个参数也很重要，对应ppraw输出的格式，注意此处的大小和最终的pprawsize不一定是相同的，例如ADA后主C950OUO模组，ppraw size是4096 * 768，但是sensor输出ppraw时不是按照一行4096个字节进行输出的，而是一行输出1024，共3072行数据输出，所以此时w=1024 h=3072，这个再sensor手册中是有的，需要找驱动确认
.type 就是pd类型，ap侧pd只涉及type2和type3
.active_area 预览图的区域
.pd_area pp点的区域，可能和预览图是有偏移的
.pp_raw 实际的ppraw参数信息，spc_enable对应是否支持spc，width和height就是最终的ppraw size，这个就是最终的整张ppraw的大小，和sensor输出的格式没有关系了；
.mirror 是否需要镜像处理，这个地方的mirror暂时没有用到
.pdaf_intensity PD本身的能力 对于dual或者qurdpd都是stront
Type3的参数如下所示：
1..pdaf = {  
2.    .enable = 1,  
3.    .vc = MIPI_VIRTUAL_CHANNEL_0,  
4.    .dt = MIPI_DATA_TYPE_USER_7,  
5.    .w = C851POL_3264X2448_PDAF_WIDTH,  
6.    .h = C851POL_3264X2448_PDAF_HEIGHT,  
7.    .type = PDAF_TYPE3,  
8.    .active_area = {  
9.        // full area  
10.        .x = 0,  
11.        .y = 0,  
12.        .width = 3264,  
13.        .height = 2448,  
14.    },  
15.    // PD area information, get from OV  
16.    .pd_area = {  
17.        .x = 0,  
18.        .y = 0,  
19.        .width = 3264,  
20.        .height = 2448,  
21.    },  
22.    .pd_block = {  
23.        .pd_count = 4,  
24.        .block_size = {  
25.            .width = 16,  
26.            .height = 16,  
27.        },  
28.        .pd_coordinate = c851pol_pd_coordinate,  
29.    },  
30.    .pdaf_intensity = PD_CONVERGENCE_WEAK,  
31.},  
vc、dt 不涉及，没有单独的ppraw通路
w、h 就是最终的ppraw的尺寸
主要的区别体现在 .pd_block 上
.Pd_count 一组block中pd点的个数
.block_size 一组block中所有像素的个数
.pd_coordinate block中pd点的位置
1.cis_pd_coordinate_t c851pol_pd_coordinate[] = {  
2.    { 1,  1,  PD_LEFT },  
3.    { 1,  5,  PD_RIGHT },  
4.    { 9,  9,  PD_RIGHT },  
5.    { 9,  13, PD_LEFT }  
6.};  
以ADA前置tele C851 OV08C为例进行介绍：
文档给出的PD pattern如下图所示，但是有一条note：“first 16*16 pattern location is (0,8) for 3264*2448”

也就是说上图的pattern是针对于3264*2448，并且从(0,8)开始的话，就是上边的pattern，如果需要从(0,0)开始，针对于全图的pattern，则需要根据重复原理，自己把pattern补全

所以从(0,0)开始的pattern就应该入下图所示：

第一步：首先按照(0,0)起始，拼一个完成的pattern，其中红框对应文档中(0,8)开始的pattern，如下所示：

第二步：结合sensor出图时的mirror和flip，进行反转和旋转，以ADL上C851为例，mirror和flip都是true，所以需要对图像进行旋转，如下所示，这个才是sensor真正的出图格式

第三步：选择最终的pattern，软件侧pd算法没有最后一行必须有pd点的约束，因此可以从任何一行开始，只要和pd area匹配就可以，默认选择从(0,0)开始
对应的 pd_area = {0, 0, 3264, 2448} （宽高必须是block的整数倍）
	对应的 coordinate = {{1, 1, right},{1, 5, left}, {9, 9, left},{9,13,right}}
	

b）2.3.1.2 cis_c876ouo_kit.h
cis_slave_info_t c876ouo_slave_info 中的 support_pdaf 设置为SUPPORT

sensor_pdaf_get_info 改函数是pp2pd模块从cfg文件中获取pd配置信息，就是上边cfg文件配置的那些
c）2.3.1.3 sensor/camkit/drv_cis_kit_pdaf_impl.c
这个是个平坦公共的文件，需要增加pd能力的获取以及pd配窗能力的获取，PD配窗能力其实对于type1的模组是由sensor本身能力决定的，配置到sensor模块是没有问题的。但是对于type2和type3的模组，其实应该是有pp2pd硬件算法或者软件算法的能力来决定的，所以其实配置到custom仓不是很合理，但是当前是配置到了custom仓

d）2.3.1.4 c876ouo_pdaf.h
配置pd配窗能力，PD配窗能力其实对于type1的模组是由sensor本身能力决定的，配置到sensor模块是没有问题的。但是对于type2和type3的模组，其实应该是有pp2pd硬件算法或者软件算法的能力来决定的，所以其实配置到custom仓不是很合理，但是当前是配置到了custom仓。

2.3.1.5 cis_c851pol.c
	对于type3的模组还需要配置crop参数，并且在这个文件配置函数获取，主要是由驱动侧进行配置，并且在isp侧调用


2.3.2Pd线性度测试 

1、首先执行开启fullsweep的命令：adb shell setprop vendor.camera.firmware.debug AF_RPOPERTY_TEST#TEST_PD_ACCURACY_FLAG#1,100,900,3,5（单程1来回2（AIAF是100），start(0表示使用默认)，end(0表示使用默认)，步长，频率(即为推马达跳帧数)）。
2、找到要测试的对象（斜条纹图、棋盘格、人像等），用支架固定起来跑fullsweep，屏显code不再动时为结束，抓取log，把isp的路径下的log放入指定的画图工具画出图像即可。
    
提示：isp路径下的log不要解压，解压画图会报错。
使用方法：
1、按照下面步骤执行，第三步按照不同模组的cameraID（后主摄：0、前主：1:、后广：2、前置副摄：3）选择不同的序号，选错可能画不出来也可能图画出来有问题。
2、进入第4个步骤，画出的图像以主摄为例的，把log路径选对，执行第6个步骤，画图结束，然后根据图像和数据来判断pd是否正常。


3、check绿色的曲线是否较为线性，绿色线过0点时对应的code（pd的final_code）是否和蓝色曲线的峰值点（top_code）接近，top_code和final code相差是否超出10-20code，超出可能就是PD_offset的数据过大，需要对pd-offset或者DCC检查是否有问题，具体问题具体分析。

2.4激光Check
在TOF AF中，激光传感器根据发出的光线和接收光线的时间来测量距离。目前项目使用的大部分是单点激光，测距能力大概在2米-3米.如果有更高精度的激光器件，例如测距距离更远的激光器件和多点激光，能进一步提高TOF使用场景和AF对焦速度和体验
一般项目会有多个激光器件厂商，前期需确认有几家激光器件厂商，明确器件规格。各个激光器件厂商都需测试。以AH平台为例，有两家激光器件（芯视-VI5300、ST- VL53L1）
1)AHH+激光主供芯视界
2)当前厂商和能力：
a)芯视界:室内4m，暗环境2m以上，不涉及驱动升级 型号名：VI5300
b)ST:新版本固件1.8m测距能力 型号名：VL53L1 V4-C方案主干驱动调好，跟CD项目保持一致
c)AMS: 测距能力2m 暗环境 1m 待决策是否要上 ---- 暂无试制计划
3)在kmsg log中搜laser，可确认激光型号，如下所示：

Check 激光测距能力，在TOF tuning前要确认TOF sensor正确启动并且报告一个正确的距离。测试方法：
1.开启AFlog命令，
2.在不同距离不同光源（1000lux、10lux）拍摄不同图卡（白墙\黑色物体\模特人脸\枯叶图）并查看log，推荐距离为2，10，20，50，100，150，200，300cm
白墙	黑墙
	
枯叶图	模特人脸
	

3.在下列参数中搜索hilog来得到距离：
rMM：打印激光传感器给的距离
s：打印激光状态status（0：可信；255：无穷远状态；1/6/7/8/9:不可信状态）
cfd：打印激光置信度（0：不可信；1:可信）

4.有多家厂商不同激光器件，不同型号都需要测试，log中的距离要与测试的物距匹配，格式参考如下：
场景	光照（lux）	实际distance
(cm)	上报distance(mm)（VIDAR）	上报distance(mm)
(ST)	VIDAR平均值	ST平
均值	VIDAR方差	ST方差
纯白色背景	10	2	51-71	54-55	63.1 	54.7 	0.316 	0.483 
		10	115-136	123-157	123.8 	128.7 	0.422 	0.483 
		50	506-531	505-516	515.3 	514.6 	0.483 	1.506 
		100	995-1020	1002-1008	1005.3 	1004.4 	0.483 	1.955 
		150	1506-1536	1511-1524	1516.3 	1518.4 	1.418 	4.088 
		200	1998-2034	1500-1500	2013.4 	1500.0 	2.319 	0.000 
		300	3098-3131	1500-1500	3118.0 	1500.0 	1.633 	0.000 
	1000	2	42-60	40-43	55.2 	40.5 	0.632 	0.527 
		10	97-121	106-111	104.4 	110.3 	0.843 	0.483 
		50	494-520	500--509	501.3 	507.5 	0.675 	0.972 
		100	981-1013	985-996	992.8 	988.1 	0.789 	2.283 
		150	1490-1520	1478-1498	1501.6 	1490.5 	1.647 	5.855 
		200	2040-2068	/	2048.3 	/	0.675 	/
		300	2971-3013	/	2992.1 	/	3.348 	/
黑色物体	10	10	89-108	101-148	101.1 	105.3 	0.316 	0.675 
		10　	89-108　	101-148	101.1	101.1	0.316	0.675 
		50	487-514	481-487	495.0 	486.9 	0.000 	0.316 
	1000	10	86-104	103-150	97	108.2	0.000 	1.317 
								
		50	495-521	495-504	502.800 	503.300 	0.422 	0.483 
模特人脸	10	50	491-522	501-534	504.0 	527.7 	1.491 	4.945 
	1000	50	480-511	501-537	493.0 	531.7 	0.667 	4.596 
枯叶图	10	2	23-39	40-41	31.5 	40.1 	0.527 	0.316 
		10	91-115	109-109	97.4 	109.0 	0.516 	0.000 
		50	502-528	508-509	511.6 	508.6 	0.699 	0.516 
		100	1003-1035	1005-1011	1014.4 	1006.3 	0.699 	1.252 
		150	1511-1542	/	1523.3 	/	1.829 	/
		200	1993-2038	/	2010.6 	/	2.951 	/
		300	3008-3054	/	3028.6 	/	6.059 	/
	1000	2	22-37	38-42	30.8 	38.9 	0.422 	0.738 
		10	96-118	109-151	102.7 	114.0 	0.483 	0.667 
		50	478-503	485-493	485.3 	492.0 	0.675 	1.491 
		100	1000-1029	1001-1011	1010.8 	1003.4 	0.919 	1.713 
		150	1496-1524	/	1509.1 	/	1.370 	/
		200	1995-2016	/	1999.0 	/	3.771 	/
		300	/	/	/	/	/	/

对比两家激光准确性测试数据：
场景	光
照(lux)	Distan
Ce(cm)	VIDAR（mm）	ST（mm）
　	min_range	max_range	range	DMAX	min_range	max_range	range	DMAX
纯白色背景	10	2	51-70	51-71	51-71	4000	54-54	55-55	54-55	4000
		10	115-135	116-136	115-136	4000	123-156	123-157	123-157	4000
		50	506-530	507-531	506-531	4000	505-512	507-516	505-516	4000
		100	996-1020	995-1020	995-1020	4000	1006-1008	1002-1007	1002-1008	4000
		150	1509-1534	1509-1536	1506-1536	4000	1515-1517	1518-1523	1511-1524	4000
		200	2003-2027	2007-2034	1998-2034	4000	1500-1500	1500-1500	1500-1500	4000
		300	3105-3128	3101-3129	3098-3131	4000	1500-1500	1500-1500	1500-1500	4000
	1000	2	42-60	43-62	42-60	4000	40-43	41-43	40-43	4000
		10	97-119	99-121	97-121	4000	106-110	107-111	106-111	4000
		50	494-518	496-520	494-520	4000	500-507	501-509	500--509	4000
		100	981-1005	988-1013	981-1013	4000	985-989	990-996	985-996	4000
		150	1490-1516	1495-1520	1490-1520	4000	1478-1483	1493-1498	1478-1498	4000
		200	2040-2068	2042-2068	2040-2068	4000	status=255
		300	2971-2998	2988-3013	2971-3013	4000	status=255
黑色物体	10	10	89-107	90-108	89-108	4000	101-147	102-148	101-148	4000
		　	　	　	　	　	　	　	　	　
		50	487-511	489-514	487-514	4000	482-486	481-487	481-487	4000
	1000	10	86-103	86-104	86-104	4000	103-149	105-150	103-150	4000
		　	　	　	　	4000	　	　	　	　
		50	495-520	496-521	495-521	4000	495-503	496-504	495-504	4000
模特人脸	10	50	491-517	497-522	491-522	4000	501-523	508-534	501-534	4000
	1000	50	480--507	473-511	480-511	4000	501-528	509-537	501-537	4000
枯叶图	10	2	23-38	24-39	23-39	4000	40-42	41-43	40-43	4000
		10	91-113	92-115	91-115	4000	105-109	105-109	105-109	4000
		50	502-526	504-528	502-528	4000	501-508	502-509	501-509	4000
		100	1003-1027	1008-1035	1003-1035	4000	1005-1006	1007-1011	1005-1011	4000
		150	1511-1535	1515-1542	1511-1542	4000	status=255
		200	1993-2021	2009-2038	1993-2038	4000	status=255
		300	3008-3037	3026-3054	3008-3054	4000	status=255
	1000	2	22-36	23-37	22-37	4000	38-40	40-42	38-42	4000
		10	96-117	97-118	96-118	4000	109-113	110-151	109-151	4000
		50	478-502	478-503	478-503	4000	485-489	487-493	485-493	4000
		100	1000-1025	1003-1029	1000-1029	4000	1001-1006	1007-1011	1001-1011	4000
		150	1496-1520	1499-1524	1496-1524	4000	status=255
		200	1995-1983	1989-2016	1995-2016	4000	status=255
		300	status=255	status=255
3AF模组厂和产线信息check
3.1模组厂信息check
请模组厂按照如下格式收集数据，目前在开发工具check

3.2产线数据check
请产线按照如下格式收集数据，目前在开发工具check

4附录
4.1常用adb命令
因为不同手机不同模组效果可能会有些许差异，而且有时候会需要确认手机型号，一些快捷的adb命令尤为重要
•查看sensor和模组厂名：
>for /l %%i in (0,1,5) do (
>echo sensor%%i
>adb shell cat data/vendor/camera/sensor%%i
>)
•查看模组SN号：
>adb shell cat data/vendor/camera/*Sn
•查看激光器件：
>adb shell "cat sys/class/sensors/laser/vendor“
•强制打开防抖
>adb shell setprop "vendor.debug.ois.mode" 111
>adb shell setprop "vendor.debug.ois.mode" 333
•没有aplog时，可以如下操作：
>*#*#2846579#*#*
>后台设置->AP LOG设置->打开
•打开3a屏显
>adb shell setprop vendor.debug.af.flag 1
>adb shell setprop vendor.debug.v2.flag 1
>adb shell setprop vendor.debug.3a_info.flag 0 //0：只开af；1：所有模块全开
>adb shell setprop vendor.debug.af_full.flag true
•手动AF（切换模式、息屏后失效）
>adb shell setprop vendor.camera.firmware.debug AF_RPOPERTY_ENABLE_MMI#TRUE  //关闭af
>adb shell setprop vendor.camera.firmware.debug AF_RPOPERTY_SET_VCM#888  //设af code
•fullsweep命令
>adb shell setprop vendor.camera.firmware.debug AF_RPOPERTY_TEST#TEST_PD_ACCURACY_FLAG#1,0,6000,10,3  // ::模式，起点，终点，步长，频率
4.2表格




个人总结
2021年部门云核心网，角色是软件工程师及license SE：
（1）作为补丁开发人员，修改不定问题12个，贡献核心可信代码5.3k，完成多个补丁版本开发；
（2）作为云化产品问题接口人，参与处理现网问题50+，闭环质量高，快速消除事故风险；
（3）作为4G/5G网上问题接口人闭环中国区运营商多个重要问题；
（4）作为 licesne SE和OM SE，支撑20+ license 紧急问题处理；
2022年部门数字能源，角色是软件工程师及committor：
 （1）作为主要的开发人员，参与EMAP平台升级重构项目的开发，完成文件传输组件的设计和开发工作，交付代码18K，缺陷率1个/KLOC，交付质量高； 
 （2）主导完成升级重构项目的联调测试工作，并支持充电场站上车新架构，定位并解决多个关键问题，支撑EMAP平台和站点梳理交付升级业务；
 （3）针对场站M4资源受限带来的功能异常，推动产品SE对所有使用资源进行统一管理，避免由于资源不足导致的功能异常。
 2023年部门数字能源，角色是软件工程师及committor：
 （1）支撑团队交付modbus证书逃生需求开发，无关键问题引入 
 （2）投入EMOS三代架构方案设计与开发，代码量10K，无问题引入 
 （3）完成文件传输基础组件和能源软总线RTU-MODBUS协议适配，完成modbus广播下载协议模块重构；
 （4）作为committor，按月参加pdu代码检视，累计发现30+问题 
 （5）参与D+拍照上云交付，作为云相机nova侧交付人员支撑解决云侧问题及诉求，推进云相机按期交付；
 （6）投入D+云相机特性，出差快速交付特性，特性效果达到预期目标
 2024年至今部门nova PDU，角色是算法工程师:
 （1）云相机承担部分模块开发，落地D+； ADA2供AIRAW模块交付； 
 （2）AF模块快速上手，牵头解决关键问题,包括上电异响及小物体不对焦等问题； 
 （3）MM+ AIAF储备交付能力； MT项目推动激光落地；自动微距切换、激光置信度优化等优化措施落地；
 （4）带领TM完成ADA/BLK/PSD的AF效果交付；
未来工作规划：
（1）作为AF田主，持续提升自身AF能力，完成后续所有nova产品的AF交付，确保AF效果不差于竞品；
（2）负责AF TM管理，确认人员不流失，对TM进行相关辅导培训，提升TM的AF问题解决处理能力；
（3）与旗舰部门技术交流，及时同步回落旗舰的AF方案，提升AF的效果及竞争力；
（4）完成AIAF方案在XIAN平台产品的落地，掌握AIAF模型原理、具备优化、训练、仿真模型的能力；
（5）积极了解内外部竞品在AF上的进展，关注业界相关的技术进展，持续提升nova在AF上的竞争力；
